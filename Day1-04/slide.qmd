---
title: Statistical Inference
subtitle: Frequentists vs Bayesians
institute: World Economic Forum
author: EPFL Extension School
date: 2023-09-28
editor:
  render-on-save: false
format:
  revealjs:
    code-copy: true
    code-link: true
    embed-resources: true
    smaller: true
    scrollable: false
    theme: ../assets/theme.scss 
    logo: ../assets/img/logo_red.png
    code-fold: true
    slide-number: true
    # chalkboard:
    #   buttons: true
    preview-links: auto
    menu: false
title-slide-attributes:
  data-background-image: img/AdobeStock_514049386.jpeg
  data-background-size: cover
  data-background-position: 100%, center
  data-background-opacity: ".2" 
from: markdown+emoji
execute:
  enabled: true
  cache: false
jupyter: python3
---


## {chalkboard-buttons="false" background-image="../assets/img/AdobeStock_536776996.jpeg"  background-size="cover" }

 
[Goal of This Session:]{style="font-size: 1.5em; font-weight: bold;"}

<br>


:heavy_check_mark: Python

<br>

:heavy_check_mark: Statistical Distributions & Inference

<br>

:heavy_check_mark: Bayesian Statistics

<br>

&#9744; [Frequentists vs Bayesians]{style="color:#ff412c;"}

&#9744; [Introduction into AB Testing]{style="color:#ff412c;"}


## Statistical Inference
#### Objective
<br> 



```{mermaid}
flowchart LR
  A(observe data) --> B(learn about its properties)
```

::: fragment
<br>

#### Frequentists vs Bayesians

<br> <br>
:::

::: fragment
| [approach]{style="color:green;"} | <font color="green">prior about $\theta$</font> | <font color="green">evidence</font> | <font color="green"> outome </font> |
|:----------------:|:------------------:|:----------------:|:----------------:|
|           Frequentists            |                 No                  |             observe $x$             |           gain limited knowledge about $\theta$           |
|           Bayesians            |          Yes          |             observe $x$             |           learn everything about $\theta$           |
:::

::: incremental 
- Frequentists rely on the [sampling distributions]{style="color:#ff332c"}
- What is [sampling distributions]{style="color:#ff332c"}? :thinking:
:::

::: notes
press c and use marker to circle around observe x for Freq approach. This approach relies too much on the observed x and makes bold assumptions about the sample. So, the whole inference will become too much dependent on the observed x. Lets discuss this by a few examples, but before we need to know what is the wholy things about Frequentism.
:::

## Sampling distribution

![](img/coin_flip.png){.absolute .r-stretch  fig-align="center" width="50%"} 
![](img/coin_flip-4.png){.absolute .fragment  width="50%"} 
![](img/coin_flip-3.png){.absolute .fragment  width="50%"}
![](img/coin_flip-1.png){.absolute .fragment  width="50%"} 
![](img/coin_flip-10.png){.absolute .fragment  width="50%"} 
![](img/coin_flip-6.png){.absolute .fragment   width="50%"} 
![](img/coin_flip-8.png){.absolute .fragment   width="50%"}
![](img/coin_flip-9.png){.absolute .fragment   width="50%"}
![](img/coin_flip-5.png){.absolute .fragment  width="50%"}
![](img/coin_flip-7.png){.absolute .fragment  width="50%"}
![](img/coin_flip-0.png){.absolute .fragment  width="50%"}
![](img/coin_flip-2.png){.fragment .fade-in  width="50%"}

. . . 

Statistical methods that rely on [sampling distributions]{style="color:#ff332c"} are sometimes called [frequentist]{style="color:#ff332c"} methods.


::: notes
notice that the graph has 11 numbers on the x axis because we're gonna repeat the experminet of flipping the coin 11 times, and each time we get different heads ratio. The binomial probability distribution in this figure is also called a sampling distribution. This terminology stems from the idea that any set of N flips is a representative sample of the behavior of the coin. If we were to repeatedly run experiments with a fair coin, such that in every experiment we flip the coin exactly N times, then, in the long run, the probability of getting each possible z (# of heads) would be the distribution shown in this plot.

note that p(head)=0.5 is fixed by null hypothesis. The ratios on the x axis are coming from the samples
:::



## Frequentists vs Bayesians
#### Example

<br> <br>

Suppose that there is a sensor in this room that measures the temperature. I take data recorded by it and observe that:

<br> <br>

::: incremental
-   10 values ranging from 18C^0^ to 22 C^0^
-   I am interested in the average temperature, which is 20 based on the data
-   I conclude that $\bar{x}=20$ is an unbiased estimator of $\theta$
-   There is a Frequentist in the room!
:::

## Frequentists vs Bayesians
#### Example

<br> <br>

Then you tell me that there is an issue with the sensor, as it caps values above 25 by 25:

<br>

::: incremental
-   You argue that $\bar{x}=20$ is no longer an unbiased estimator of $\theta$
-   That's true even though my 10 values were between 18 to 22
-   Future realisations of the measurements could be large
:::

## Frequentists vs Bayesians
#### Example

<br> <br>

As a Bayesian, you argue that: 

::: incremental
-   You can have a prior about the parameter $\theta$
-   Then, the 10 observed values can serve as a piece of evidence
-   That leads to a posterior about $\theta$
:::

## Frequentism vs Bayesianism

![](img/freq_bayes.jpg){.absolute bottom="20"}

![](img/freq.jpg){.absolute .fragment .fade-in bottom="20"}

![](img/bayes.jpg){.absolute .fragment .fade-in bottom="20"}


::: notes
frequentists reason horizontally, with mu fixed and x varying, while Bayesian inference proceeds vertically, with x fixed, according to the posterior distribution of mu.

- Bayesian inference requires a prior distribution g(mu). When past experience provides g, there is every good reason to employ Bayes' theorem.
-   Frequentism replaces the choice of a prior with the choice of a method t(x), designed to answer the specific question at hand. This adds an arbitrary element to the inferential process
- In the absence of genuine prior information, a whiff of subjectivity hangs over Bayesian results, even those based on uninformative priors. Classical frequentism claimed for itself the high ground of scientific objectivity

**Frequentist**: they assume that we can [repeatedly]{.rn rn-type="highlight" rn-color="red"} have realisations of the measurements from the sensor, but we are able to only observe one such realisations, and infer $\theta$. The imaginary repeated realsations can constitute the whole spectrum of values for $\theta$

- **Bayesians**: they take the only [observable]{style="color:red;"} realisation, and infer the whole spectrum of values for $\theta$. They don't rely on any other imaginary realisation. However they need to rely on a prior about $\theta$.
:::

## {chalkboard-buttons="false" background-image="img/AdobeStock_81141285.jpeg" background-position="center"  background-repeat="no-repeat" background-opacity="0.6" background-size="cover"}

<!-- ### Introduction to A/B testing { style="color:#fcf6f5;" } -->

## What is A/B testing?

<br> 

::: columns
::: {.column width="60%" }
- It is about comparing the performance of `two versions of a subject`. 
- It tests a control version against a variant of it, and determines which of the two versions better leads to a `target action`.
:::
::: {.column width="40%" }
![](img/AdobeStock_622804216.jpeg){width="80%" fig-align="left"}
:::
:::

::: columns
::: {.column width="60%" }
- It is used in understanding the `user engagement` and behavior on services or products.
- As an examples, in marketing, it is used to test which version of an `online advertisement` leads to more sales.  
::: 
::: {.column width="40%" }
![](img/AdobeStock_480543921.jpeg){width="80%" fig-align="left"}
:::
:::

::: notes
- Version A might be used at present (thus forming the control group), while version B is modified in some respect vs. A (thus forming the treatment group). 
- In general, it helps determine what is and isn’t working in the marketing campaign.
- The big downside of multivariate testing is that you need an enormous amount of traffic for results to be statistically meaningful. 
- bayes vs freq: if you’re testing a new feature for the first time or with a different user segment, those priors may not be relevant. The less similar a test is to a previous one, the better off you are starting fresh with a pure frequentist analysis
- bayes vs freq: freq need more data (hence more visitors tested and over longer durations)
- bayes vs freq: in freq you feel like you're doing a math problem, in bayes you're dealing with an everyday life problem
:::

## Implementing A/B Testing

<!-- <br> -->

::: columns
::: {.column width="60%" }
#### Do you research, understand the:
  - Business
  - Product
  - Users
:::
::: {.column width="40%" }
![](img/AdobeStock_260295411.jpeg){width="55%" fig-align="left"}
:::
:::

::: columns
::: {.column width="60%" }
#### Formulate the problem
  -  Analyze past data
  -  Define the goal of the test
  -  Choose the metrics to measure
  <!-- -  Decide on the sample size   -->
::: 
::: {.column width="40%" }
![](img/AdobeStock_527930015.jpeg){width="50%" fig-align="left"}
:::
:::

::: columns
::: {.column width="60%" }
#### Run the test
  -  Randomly assign users to groups
  -  Record the results
  -  Monitor the outcomes
::: 
::: {.column width="40%" }
![](img/AdobeStock_128491416.jpeg){width="60%" fig-align="left"}
:::
:::

## Implementing A/B Testing

<br><br>

::: columns
::: {.column width="60%" }
#### Statistical analysis of the results: 
  - Frequentist approach
  - <span class="fragment highlight-blue" fragment-index=3>Bayesian approach</span>
:::
::: {.column width="40%" }
![](img/AdobeStock_95004747.jpeg){width="80%" fig-align="left"}
:::
:::

<br>

::: columns
::: {.column width="60%" }
#### Conclude the test
  -  Decide whether to stop or continue the test
  -  Implement the winning variation
  -  Monitor the results
::: 
::: {.column width="40%" }
![](img/AdobeStock_502864568.jpeg){width="80%" fig-align="left"}
:::
:::

::: {.fragment fragment-index=1}
::: {.absolute top="13%" bottom="55%"  right="62%" width="420" }
::: {.blackbox}
:::
:::
:::

<!-- - Do you research: understand the business, the product, and its users
- Formulate the problem
  -  Analyze past data
  -  Define the goal of the test
  -  Choose the metrics to measure
  -  Decide on the sample size
- Run the test
  -  Randomly assign users to groups
  -  Record the results
- Statistical analysis of the results: Frequentist and Bayesian
- Conclude the test
  -  Decide whether to stop or continue the test
  -  Implement the winning variation
  -  Monitor the results -->


::: notes
- Once the test is running, performance should be monitored in real time. Because the test may not go as expected, and should be stopped or adjusted.

- stop or continue: Take what you learned and formulate your next round of testing.
A/B testing and experimentation strategy are all about building feedback loops. Findings lead to more findings, optimization leads to further optimization, and rising customer engagement leads to more engagement. 

- Statistical analysis of the results: 5% vs 7% then go for B, but a more rigorous approach would involve applying statistical testing to determine if the differences in response rates between A and B were statistically significant (that is, highly likely that the differences are real, repeatable, and not due to random chance)
:::

## A/B testing example

<br>


## Slide Title {visibility="hidden"}

Tips to improve your A/B testing:
- break your testing audience into some common sense segments, eg: By demographics, By geography, New vs. returning visitors
- START SIMPLE, then REFINE YOUR SEGMENTS: 
Experimentation is an iterative process, meaning you must take it step by step. Once you have meaningful results for these higher-level segments, you can go more granular and try to discover important nuances about smaller and smaller ones.
- FAVOR RECENT DATA:
Business moves fast. Your experimentation data should move even faster. 

Common A/B testing mistakes:
- lack of domain knowledge
- not enough data
- not enough time
- not enough traffic
- not enough conversions
- not enough patience

## A few Key Terms

<br> <br>

##### Conversion Rate

> proportion of visitors that perform the target action

<br>

##### Uplift 

> difference between the conversion rates of the two variants

<br>

##### HDI

> highest density interval


## data vs prior

- discuss the impact of sample size on the posterior distribution
- discuss the impact of prior on the posterior distribution

## load synthetic dataset and explore it




## {chalkboard-buttons="false" background-image="../assets/img/Quiz_AdobeStock_439133763.jpeg" background-position="center"  background-repeat="no-repeat" background-opacity="0.9" background-size="cover"}

## {chalkboard-buttons="false" background-image="../assets/img/QA_AdobeStock_206674448.jpeg" background-position="center"  background-repeat="no-repeat" background-opacity="0.9" background-size="cover"}


<!-- ::: columns
::: {.column width="60%" }
- Conversion rate: proportion of visitors that perform the target action
- Bernoulli and value conversions
::: 
::: {.column width="40%" }
![](img/AdobeStock_167565046.jpeg){width="60%" fig-align="left"}
:::
:::

::: columns
::: {.column width="60%" }
- Uplift: the difference between the conversion rates of the two variants
::: 
::: {.column width="40%" }
![](img/AdobeStock_128491416.jpeg){width="60%" fig-align="left"}
:::
:::

::: columns
::: {.column width="60%" }
- HDI: 
::: 
::: {.column width="40%" }
![](img/AdobeStock_128491416.jpeg){width="60%" fig-align="left"}
:::
::: -->

<!-- ::: goal
How to do AB testing based on the Bayesian methods?
::: -->


<!-- [shinylive](https://shinylive.io/py/app/#code=NobwRAdghgtgpmAXGKAHVA6VBPMAaMAYwHsIAXOcpMASxlWICcyACAZwAsaJs2B3KGUIcAOhDoNmLGINQAbYmTk0ARlmzzFLKGxbyyYiU1YQArvWzbdEVGIBmjYjHZceLI1ICC6PC0aUAEzhGX1Mae0dnNkIaHAw2MkFdD1YVOESxMTRUAH0wlgBeFjCsKABzOBy7OTCAgAoxFiaXbl4BIQ4MMg44eHjTVGCexzqASjxG5pK5KGxiUzIcthoglShGBohm7eKaUog4OSWVuDWNyZ2dgGIWABUaJTgLy6m9jgAWTZfvlhEwAAliHwWAFiHBdKh1rB0sFdMQ7CxunAWAAhdJQEE0BKMVQLGikFjCKAQCqInouNDI+HuMgQxxrFQ0ZRkSxBCDLFksOymCCEMj4iAAfj+z2+41FLxu3FQC3YyiCjAllxK0oWS3lwQaKD+vj+AAUofAKIxtDqWAAGXwAVktLCt4q2PyaKpsarYGvOYBUZv1hphJu9+At1tt9omjqdJVQWoAcoo4IhtCwAHzBlgqFMWv4OsXh75R4mHHIybhfJ27DDzMgyxaaMha6DwHKoAJ2bN5l455oO0aZCBiIIItjBABumtVZF8VZrvmHbGWpFGiGeAAFpwtV-4IAqsAp61A5GQCn9PCw9QARABi2eeg5YjcqLbsY2XEZ2NgwjGJoJg8TgcHqABGABOAA2AAOc1IMA3s322G5h1YJE-GJUlzQAHgKAAPTDAKVFgsMKe9MGUdlIUIOA6ltQCQ1g759F3RQ6iw3w0kSLBW2Y3wJwwKAxm410yAwFQxnGX4vQAWjNOQ+AKABmOiXgY-lHi1VB6SgRlmVZSgOUsbleX5AlqTRDIwEUy4GOwGY0jkLUbzg5oGKwmzDns8z8IYuQ4Aqbc6gUQhjy9cEDCDBxoVIApLwPYdYM8w94g4IExj7LJ0CI7xo2yPIaFnUdgl8VZTDKApbkYUw4FgsAAF88HAB9qH8ABHMJ-Hgcg2C6LCyHwIhSAoKhkE4Vp+EEYQaoAXSAA) -->


<!-- ## {chalkboard-buttons="false" background-image="../assets/img/Handson_AdobeStock_316152114.jpeg" background-position="center"  background-repeat="no-repeat" background-opacity="0.5" background-size="cover"}

![](../assets/img/python-logo-inkscape.svg){width="30%" height="30%" fig-align="center"}

Optional hands-on session: 

-   Open the Jupyter notebook in `Day1-04/hands-on.ipynb`
-   Follow the instructions in the notebook, and run the codes.

::: notes
let them run code in the notebook that does AB testing with synthetic data based on frequentist approach, and say thaz they will learn bayesian approach tomorrow
::: -->